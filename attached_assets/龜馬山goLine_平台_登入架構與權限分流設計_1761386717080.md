
# ğŸ—ï¸ é¾œé¦¬å±± goLine å¹³å° â€” ç™»å…¥æ¶æ§‹èˆ‡æ¬Šé™åˆ†æµè¨­è¨ˆï¼ˆæ­£å¼ç‰ˆï¼‰

## ä¸€ã€æ•´é«”è¨­è¨ˆæ¦‚å¿µ
é¾œé¦¬å±± goLine å¹³å°æ•´åˆ **LIFFï¼ˆLINE Front-end Frameworkï¼‰** èˆ‡ **LINE Loginï¼ˆOAuth 2.0ï¼‰**ï¼Œä¾ä½¿ç”¨æƒ…å¢ƒåˆ†ç‚ºã€Œå‰å°æœå‹™ã€èˆ‡ã€Œå¾Œå°ç®¡ç†ã€å…©å¤§å…¥å£ã€‚

---

## äºŒã€æ¶æ§‹ç¸½è¦½

| é¡å‹ | ç™»å…¥æ–¹å¼ | ä¸»è¦ç”¨é€” | ä½¿ç”¨è€…è§’è‰² | è£ç½®ç’°å¢ƒ |
|------|------------|-----------|--------------|-----------|
| **å‰å°ï¼ˆLIFFï¼‰** | LINE App å…§ç™»å…¥ï¼ˆLIFF SDKï¼‰ | æ—¥å¸¸ä½œæ¥­ï¼ˆç°½åˆ°ã€æ’ç­ã€ç¥æœæœå‹™ï¼‰ | userã€poweruserã€adminã€superadmin | è¡Œå‹•è£ç½®ï¼ˆLINE å…§ï¼‰ |
| **å¾Œå°ï¼ˆLINE Loginï¼‰** | OAuth 2.0 ç™»å…¥ï¼ˆå¤–éƒ¨ç€è¦½å™¨ï¼‰ | ç³»çµ±ç®¡ç†ã€å ±è¡¨åŒ¯å‡ºã€è¨­å®šå·¡é‚é»ã€è§’è‰²ç®¡ç† | poweruserã€adminã€superadmin | æ¡Œæ©Ÿ / å¹³æ¿ç€è¦½å™¨ |

---

## ä¸‰ã€è§’è‰²èˆ‡æ¬Šé™å°ç…§è¡¨

| è§’è‰² | èªªæ˜ | å¯ä½¿ç”¨ LIFF å‰å° | å¯ä½¿ç”¨ LINE Login å¾Œå° | æ¬Šé™æ‘˜è¦ |
|------|------|------------------|-------------------------|-----------|
| **user** | ä¸€èˆ¬ä½¿ç”¨è€… / å¿—å·¥ / å·¥ä½œåŒä» | âœ… æ’ç­ã€ç°½åˆ°ã€ç¥æœæœå‹™ | âŒ ç„¡æ³•ç™»å…¥å¾Œå° | åªèƒ½åŸ·è¡Œå€‹äººæ“ä½œï¼Œä¸å…·ç®¡ç†æ¬Š |
| **poweruser** | ç®¡ç†è€… / å¹¹éƒ¨ | âœ… å¯ç°½åˆ°æˆ–æŸ¥çœ‹å‰å°ç‹€æ³ | âœ… å¯æŸ¥çœ‹ç´€éŒ„ã€åŒ¯å‡ºå ±è¡¨ | åªèƒ½æŸ¥è©¢è³‡æ–™ï¼Œç„¡æ³•ä¿®æ”¹è¨­å®š |
| **admin** | ç³»çµ±ç®¡ç†è€… | âœ… å¯åŸ·è¡Œå‰å°ä»»å‹™ | âœ… å¯ç®¡ç†å·¡é‚é» / ä½¿ç”¨è€… | ç³»çµ±ç¶­è­·èˆ‡ç®¡ç†æ“ä½œ |
| **superadmin** | æœ€é«˜ç³»çµ±ç®¡ç†è€… | âœ… å¯åŸ·è¡Œå‰å°ä»»å‹™ | âœ… å®Œæ•´å¾Œå°æ¬Šé™ï¼ˆå«è§’è‰²è¨­å®šï¼‰ | æ“æœ‰æœ€é«˜æ§åˆ¶æ¬Š |

---

## å››ã€ç™»å…¥åˆ†æµæ¶æ§‹

### 1ï¸âƒ£ LIFFï¼ˆå‰å°å…¥å£ï¼‰
- ç™»å…¥è§’è‰²ï¼š`user`ã€`poweruser`ã€`admin`ã€`superadmin`
- å°å‘é é¢ï¼š
  - `/checkin/index.html` â€” å¥‰é¦™ç°½åˆ°ç³»çµ±
  - `/schedule/index.html` â€” æ’ç­ç³»çµ±
  - `/service/index.html` â€” ç¥æœæœå‹™ï¼ˆé»ç‡ˆ / æ³•æœƒå ±å / é¦™æ²¹éŒ¢ï¼‰
- ç‰¹æ€§ï¼š
  - åœ¨ LINE App å…§é–‹å•Ÿï¼Œä¸éœ€è·³è½‰å¤–éƒ¨ç€è¦½å™¨
  - è‡ªå‹•å–å¾— LINE ä½¿ç”¨è€…è³‡æ–™ï¼ˆ`liff.getProfile()`ï¼‰
  - å‰å°è¡Œç‚ºçš†èˆ‡ Firebase åŒæ­¥

### 2ï¸âƒ£ LINE Loginï¼ˆå¾Œå°å…¥å£ï¼‰
- ç™»å…¥è§’è‰²ï¼š`poweruser`ã€`admin`ã€`superadmin`
- å°å‘é é¢ï¼š
  - `/checkin/admin/index.html` â€” ç°½åˆ°ç´€éŒ„æŸ¥è©¢ã€åŒ¯å‡º
  - `/checkin/admin/patrols.html` â€” å·¡é‚é»ç®¡ç†ã€QR Code ç”¢ç”Ÿ
  - `/checkin/admin/users.html` â€” ä½¿ç”¨è€… / è§’è‰²ç®¡ç†
  - ï¼ˆæœªä¾†ï¼‰`/schedule/admin/`ã€`/service/admin/` ç­‰æ¨¡çµ„å¾Œå°
- ç‰¹æ€§ï¼š
  - ä½¿ç”¨ OAuth æˆæ¬Šæµç¨‹
  - ç™»å…¥å¾Œå–å¾— access tokenï¼Œå†å‘ Firebase é©—è­‰
  - å¯è·¨è£ç½®ä½¿ç”¨ï¼ˆæ¡Œæ©Ÿã€å¹³æ¿ã€æ‰‹æ©Ÿç€è¦½å™¨ï¼‰

---

## äº”ã€è§’è‰²æ¬Šé™æ‘˜è¦ï¼ˆæ•´åˆçŸ©é™£ï¼‰

| åŠŸèƒ½ / é é¢ | user | poweruser | admin | superadmin |
|--------------|------|-----------|--------|-------------|
| **å¥‰é¦™ç°½åˆ°ï¼ˆLIFFï¼‰** | âœ… | âœ… | âœ… | âœ… |
| **æ’ç­ç³»çµ±ï¼ˆLIFFï¼‰** | âœ… | âœ… | âœ… | âœ… |
| **ç¥æœæœå‹™ï¼ˆLIFFï¼‰** | âœ… | âœ… | âœ… | âœ… |
| **æŸ¥çœ‹ç°½åˆ°ç´€éŒ„ï¼ˆå¾Œå°ï¼‰** | âŒ | âœ… | âœ… | âœ… |
| **åŒ¯å‡ºå ±è¡¨** | âŒ | âœ… | âœ… | âœ… |
| **å·¡é‚é»ç®¡ç†** | âŒ | âŒ | âœ… | âœ… |
| **ä½¿ç”¨è€…ç®¡ç†ï¼ˆè§’è‰²è¨­å®šï¼‰** | âŒ | âŒ | âœ… | âœ…ï¼ˆå«è®Šæ›´ admin/superadminï¼‰ |
| **è§’è‰²æˆæ¬Šç®¡ç†** | âŒ | âŒ | âœ…ï¼ˆä¸å«è¶…ç®¡ï¼‰ | âœ…ï¼ˆå«è¶…ç®¡ï¼‰ |

---

## å…­ã€æŠ€è¡“å¯¦ä½œé‡é»

1. **å…±ç”¨ä½¿ç”¨è€…è³‡æ–™**
   ```js
   users = {
     uid: "LINE_USER_ID",
     displayName: "ç‹å¤§æ˜",
     pictureUrl: "...",
     role: "user" | "poweruser" | "admin" | "superadmin",
     lastLoginAt: Timestamp,
     createdAt: Timestamp
   }
   ```
   - é¦–æ¬¡ç™»å…¥è‡ªå‹•å»ºç«‹å¸³è™Ÿï¼Œé è¨­ `role = "user"`
   - è‹¥å·²æœ‰è³‡æ–™å‰‡æ›´æ–°ç™»å…¥æ™‚é–“

2. **å‰ç«¯æ¬Šé™é˜²è­·**
   ```js
   if (role === 'user') {
     alert('æ‚¨æ²’æœ‰å¾Œå°æ¬Šé™');
     window.location.href = '/checkin/index.html';
   }
   ```

3. **ç™»å…¥æ–¹å¼å€åˆ†**
   - **LIFF ä½¿ç”¨ï¼š**
     ```js
     await liff.init({ liffId: "XXXX" });
     const profile = await liff.getProfile();
     ```
   - **LINE Login ä½¿ç”¨ï¼š**
     ```js
     GET https://access.line.me/oauth2/v2.1/authorize?response_type=code...
     â†’ å–å¾— code â†’ æ›å– token â†’ å– user info â†’ Firebase ç´€éŒ„
     ```

---

## ä¸ƒã€çµè«–ï¼ˆæ‘˜è¦ï¼‰

| æ¨¡çµ„ | ç™»å…¥æ–¹å¼ | ä½¿ç”¨è§’è‰² | ç¯„ä¾‹é é¢ |
|------|-----------|-----------|-----------|
| å¥‰é¦™ç°½åˆ° / æ’ç­ / ç¥æœæœå‹™ | **LIFF** | å…¨è§’è‰²å¯ç”¨ | `/checkin/index.html`ã€`/schedule/index.html`ã€`/service/index.html` |
| å¾Œå°ç®¡ç†ï¼ˆæŸ¥è©¢ / åŒ¯å‡º / è¨­å®šï¼‰ | **LINE Login** | poweruserâ†‘ | `/checkin/admin/...`ã€`/schedule/admin/...`ã€`/service/admin/...` |

---

## å…«ã€æ•´åˆç¤ºæ„åœ–ï¼ˆv3ï¼‰

**LIFFï¼ˆå‰å°ï¼‰ â†’** æ’ç­ã€ç°½åˆ°ã€ç¥æœæœå‹™  
**LINE Loginï¼ˆå¾Œå°ï¼‰ â†’** ç®¡ç†é ï¼ˆæŸ¥è©¢ã€åŒ¯å‡ºã€è¨­å®šï¼‰

> ğŸ”¹ userï¼šåªèƒ½ä½¿ç”¨ LIFF  
> ğŸ”¹ poweruser / admin / superadminï¼šå¯ç”¨ LIFF + LINE Login  
> ğŸ”¹ superadminï¼šæ“æœ‰æ‰€æœ‰å¾Œå°æ¬Šé™
